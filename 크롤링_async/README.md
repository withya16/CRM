# 크롤링 비동기 처리 버전

이 폴더는 기존 크롤링 코드의 **비동기 처리 버전**입니다. 
I/O 대기 시간을 활용하여 성능을 개선하되, 차단 방지를 위한 안전장치가 포함되어 있습니다.

## 주요 변경사항

### 1. `competitor_llm.py` - LLM API 호출 비동기 처리
- **변경**: `aiohttp`를 사용하여 LLM API 호출을 비동기로 처리
- **성능**: 여러 배치의 LLM 호출을 동시에 처리하여 전체 실행 시간 단축
- **차단 방지**:
  - `Semaphore(MAX_CONCURRENT_REQUESTS=3)`로 동시 요청 수 제한
  - 각 요청 사이 0.5초 딜레이 유지
  - 429 에러 시 지수 백오프 재시도

### 2. `google_crawler_togooglesheet.py` - 기사 본문 크롤링 비동기 처리
- **변경**: 기사 본문 크롤링을 `aiohttp`로 비동기 처리
- **성능**: 여러 기사의 본문을 동시에 크롤링하여 시간 단축
- **차단 방지**:
  - `Semaphore(MAX_CONCURRENT_REQUESTS=5)`로 동시 요청 수 제한
  - 각 요청 사이 0.3초 딜레이 유지
  - 구글 검색 결과 추출은 Selenium으로 순차 처리 유지 (차단 방지)

### 3. `dart_mapping.py`
- **변경 없음**: 비동기 처리 필요 없음 (DART API 호출이 적음)

## 설치 방법

```bash
pip install -r requirements.txt
```

## 실행 방법

기존 코드와 동일하게 실행합니다:

```bash
python run_pipeline.py
```

## 성능 개선 효과

### 예상 개선 효과 (예시)
- **기존 (순차 처리)**: 100개 기사 본문 크롤링 시 약 50초 (기사당 0.5초)
- **비동기 처리 (5개 동시)**: 약 10초 (5배 개선)

- **기존 (순차 처리)**: 10개 배치 LLM 호출 시 약 5분 (배치당 30초)
- **비동기 처리 (3개 동시)**: 약 2분 (2.5배 개선)

*실제 성능은 네트워크 상태, API 응답 시간에 따라 달라질 수 있습니다.*

## 차단 방지 전략

### 1. 동시 요청 수 제한
- LLM API: 최대 3개 동시 요청
- 기사 본문 크롤링: 최대 5개 동시 요청

### 2. 딜레이 유지
- 각 요청 사이 짧은 딜레이 유지 (0.3~0.5초)
- 배치/경쟁사 사이 대기 시간 유지

### 3. 에러 처리
- 429 (Too Many Requests) 에러 시 자동 재시도 (지수 백오프)
- 타임아웃 처리

### 4. 순차 처리 유지 (필요시)
- 구글 검색 결과 추출은 Selenium으로 순차 처리 (차단 위험 높음)

## 주의사항

1. **API Rate Limit**: 비동기 처리를 사용하더라도 API 제공자의 Rate Limit을 확인하세요.
2. **IP 차단**: 과도한 동시 요청은 IP 차단을 유발할 수 있습니다. `MAX_CONCURRENT_REQUESTS` 값을 조정하세요.
3. **메모리 사용량**: 동시 요청 수가 많을수록 메모리 사용량이 증가합니다.

## 설정 조정

차단이 발생하거나 성능을 더 개선하려면 다음 값을 조정할 수 있습니다:

### `competitor_llm.py`
```python
MAX_CONCURRENT_REQUESTS = 3  # 동시 요청 수 (줄이면 안전, 늘리면 빠름)
```

### `google_crawler_togooglesheet.py`
```python
MAX_CONCURRENT_REQUESTS = 5  # 동시 요청 수 (줄이면 안전, 늘리면 빠름)
```

## 기존 코드와의 비교

| 항목 | 기존 버전 | 비동기 버전 |
|------|----------|------------|
| LLM API 호출 | 순차 처리 | 비동기 (3개 동시) |
| 기사 본문 크롤링 | 순차 처리 (Selenium) | 비동기 (aiohttp, 5개 동시) |
| 구글 검색 결과 추출 | 순차 처리 (Selenium) | 순차 처리 (Selenium, 유지) |
| 차단 위험 | 낮음 | 낮음 (제한된 동시성) |
| 실행 속도 | 보통 | 빠름 (2~5배) |




